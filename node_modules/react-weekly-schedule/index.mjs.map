{"version":3,"file":"index.mjs","sources":["src/components/DefaultEventRootComponent.tsx","src/context.ts","src/utils/createPageMapCoordsToContainer.ts","src/hooks/useClickAndDrag.ts","src/hooks/useMousetrap.ts","src/utils/getSpan.ts","src/utils/createGrid.ts","src/utils/cellToDate.ts","src/utils/createMapCellInfoToRecurringTimeRange.ts","src/utils/createMapDateRangeToCells.ts","src/utils/getEarliestTimeRange.ts","src/utils/mergeEvents.ts","src/components/Cell.tsx","src/utils/getTextForDateRange.ts","src/components/EventContent.tsx","src/components/RangeBox.tsx","src/components/Schedule.tsx","src/components/TimeGridScheduler.tsx"],"sourcesContent":["import React from 'react';\nimport { EventRootProps } from '../types';\n\nexport const DefaultEventRootComponent = React.forwardRef<any, EventRootProps>(\n  function DefaultEventRootComponent(\n    {\n      isActive,\n      handleDelete,\n      cellIndex,\n      rangeIndex,\n      classes,\n      disabled,\n      ...props\n    },\n    ref,\n  ) {\n    return <div ref={ref} aria-disabled={disabled} {...props} />;\n  },\n);\n","import en from 'date-fns/locale/en';\nimport { createContext } from 'react';\n\nexport const SchedulerContext = createContext({ locale: en });\n","export const createPageMapCoordsToContainer = (container: HTMLElement) => {\n  return (event: React.MouseEvent | MouseEvent | TouchEvent) => {\n    let clientX: number;\n    let clientY: number;\n    let pageX: number;\n    let pageY: number;\n\n    if ('changedTouches' in event) {\n      ({ clientX, clientY, pageX, pageY } = event.changedTouches[0]);\n    } else {\n      ({ clientX, clientY, pageX, pageY } = event);\n    }\n    const { top, left } = container.getBoundingClientRect();\n\n    return {\n      clientX,\n      clientY,\n      pageX,\n      pageY,\n      top,\n      left,\n      x: clientX - left,\n      y: clientY - top,\n    };\n  };\n};\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { fromEvent, merge, Observable, of } from 'rxjs';\nimport {\n  delay,\n  filter,\n  map,\n  mergeMap,\n  startWith,\n  takeUntil,\n  tap,\n} from 'rxjs/operators';\nimport { Rect } from '../types';\nimport { createPageMapCoordsToContainer } from '../utils/createPageMapCoordsToContainer';\n\nconst prevent = tap((e: TouchEvent) => {\n  e.preventDefault();\n  e.stopPropagation();\n});\n\nexport function useClickAndDrag(\n  ref: React.RefObject<HTMLElement>,\n  isDisabled?: boolean,\n) {\n  const [style, setStyle] = useState<React.CSSProperties>({\n    transform: 'translate(0, 0)',\n    width: 0,\n    height: 0,\n  });\n  const [box, setBox] = useState<Rect | null>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [hasFinishedDragging, setHasFinishedDragging] = useState(false);\n  const container = ref.current;\n\n  useEffect(() => {\n    if (!container || isDisabled) {\n      return;\n    }\n\n    const mapCoordsToContainer = createPageMapCoordsToContainer(container);\n\n    const touchMove$ = fromEvent<TouchEvent>(window, 'touchmove', {\n      passive: false,\n    }).pipe(prevent);\n\n    const touchEnd$ = fromEvent<TouchEvent>(window, 'touchend', {\n      passive: true,\n    });\n\n    const touchStart$ = fromEvent<TouchEvent>(container, 'touchstart', {\n      passive: false,\n    });\n\n    const touchStartWithDelay$ = touchStart$.pipe(\n      mergeMap(start =>\n        of(start).pipe(\n          delay(300),\n          takeUntil(touchMove$),\n          prevent,\n        ),\n      ),\n    );\n\n    const mouseDown$ = fromEvent<MouseEvent>(container, 'mousedown', {\n      passive: true,\n    }).pipe(filter(event => event.which === 1));\n\n    const mouseMove$ = fromEvent<MouseEvent>(window, 'mousemove', {\n      passive: true,\n    });\n\n    const mouseUp$ = fromEvent<MouseEvent>(window, 'mouseup', {\n      passive: true,\n    });\n\n    const dragStart$ = merge(mouseDown$, touchStartWithDelay$).pipe(\n      map(mapCoordsToContainer),\n    );\n\n    const dragEnd$ = merge(mouseUp$, touchEnd$).pipe(\n      map(mapCoordsToContainer),\n      tap(() => {\n        setIsDragging(false);\n        setHasFinishedDragging(true);\n      }),\n    );\n\n    const move$ = merge(mouseMove$, touchMove$).pipe(map(mapCoordsToContainer));\n\n    const box$: Observable<Rect | null> = dragStart$.pipe(\n      tap(() => {\n        setIsDragging(true);\n        setHasFinishedDragging(false);\n      }),\n      mergeMap(down => {\n        return move$.pipe(\n          startWith(down),\n          map(\n            (move): Rect => {\n              const startX = Math.max(down.x, 0);\n              const startY = Math.max(down.y, 0);\n              const endX = Math.min(move.x, container.scrollWidth);\n              const endY = Math.min(move.y, container.scrollHeight);\n              const top = Math.min(startY, endY);\n              const bottom = Math.max(startY, endY);\n              const left = Math.min(startX, endX);\n              const right = Math.max(startX, endX);\n\n              return {\n                startX,\n                startY,\n                endX,\n                endY,\n                top,\n                bottom,\n                left,\n                right,\n                width: right - left,\n                height: bottom - top,\n              };\n            },\n          ),\n          takeUntil(dragEnd$),\n        );\n      }),\n      map(rect => {\n        return rect.width === 0 && rect.height === 0 ? null : rect;\n      }),\n    );\n\n    const style$ = box$.pipe(\n      map(rect => {\n        if (rect !== null) {\n          const { width, height, left, top } = rect;\n          return {\n            transform: `translate(${left}px, ${top}px)`,\n            width,\n            height,\n          };\n        }\n\n        return { display: 'none' };\n      }),\n    );\n\n    const boxSubscriber = box$.subscribe(setBox);\n    const styleSubscriber = style$.subscribe(setStyle);\n\n    return () => {\n      boxSubscriber.unsubscribe();\n      styleSubscriber.unsubscribe();\n    };\n  }, [container, isDisabled]);\n\n  const cancel = useCallback(() => {\n    setIsDragging(false);\n    setHasFinishedDragging(false);\n    setBox(null);\n  }, []);\n\n  return { style, box, isDragging, cancel, hasFinishedDragging };\n}\n","import Mousetrap from 'mousetrap';\nimport { useEffect, useRef } from 'react';\n\n/**\n * Use mousetrap hook\n *\n * @param handlerKey - A key, key combo or array of combos according to Mousetrap documentation.\n * @param  handlerCallback - A function that is triggered on key combo catch.\n */\nexport function useMousetrap(\n  handlerKey: string | string[],\n  handlerCallback: (e: ExtendedKeyboardEvent, combo: string) => void,\n  elementOrElementRef: typeof document | React.RefObject<Element | null>,\n) {\n  const actionRef = useRef<typeof handlerCallback | null>(null);\n  actionRef.current = handlerCallback;\n  const element =\n    'current' in elementOrElementRef ? elementOrElementRef.current : document;\n\n  useEffect(() => {\n    const instance = new Mousetrap(element as Element);\n\n    instance.bind(handlerKey, (e, combo) => {\n      typeof actionRef.current === 'function' && actionRef.current(e, combo);\n    });\n\n    return () => {\n      instance.unbind(handlerKey);\n    };\n  }, [handlerKey, element]);\n}\n","export const getSpan = (x1: number, x2: number) => 1 + Math.abs(x2 - x1);\n","import clamp from 'lodash/clamp';\nimport floor from 'lodash/floor';\nimport round from 'lodash/round';\nimport { CellInfo, Grid, Rect } from '../types';\nimport { getSpan } from './getSpan';\n\nexport const createGrid = ({\n  totalHeight,\n  totalWidth,\n  numVerticalCells,\n  numHorizontalCells,\n}: {\n  totalHeight: number;\n  totalWidth: number;\n  numVerticalCells: number;\n  numHorizontalCells: number;\n}): Grid => {\n  const cellHeight = totalHeight / numVerticalCells;\n  const cellWidth = totalWidth / numHorizontalCells;\n\n  return {\n    totalHeight,\n    totalWidth,\n    numVerticalCells,\n    numHorizontalCells,\n    cellWidth,\n    cellHeight,\n\n    getRectFromCell(data: CellInfo) {\n      const { endX, startX, endY, startY, spanX, spanY } = data;\n      const bottom = endY * this.cellHeight;\n      const top = startY * this.cellHeight;\n      const left = startX * this.cellWidth;\n      const right = endX * this.cellWidth;\n      const height = spanY * this.cellHeight;\n      const width = spanX * this.cellWidth;\n\n      return {\n        bottom,\n        top,\n        left,\n        right,\n        height,\n        width,\n\n        // @TODO: check the math\n        startX: startX * this.cellWidth,\n        endX: endX * this.cellWidth,\n        startY: startY * this.cellHeight,\n        endY: endY * this.cellHeight,\n      };\n    },\n\n    getCellFromRect(data: Rect) {\n      const startX = clamp(\n        floor(data.left / this.cellWidth),\n        0,\n        numHorizontalCells - 1,\n      );\n      const startY = clamp(\n        round(data.top / this.cellHeight),\n        0,\n        numVerticalCells - 1,\n      );\n      const endX = clamp(\n        floor(data.right / this.cellWidth),\n        0,\n        numHorizontalCells - 1,\n      );\n      const endY = clamp(\n        round(data.bottom / this.cellHeight),\n        0,\n        numVerticalCells - 1,\n      );\n      const spanX = clamp(getSpan(startX, endX), 1, numHorizontalCells);\n      const spanY = clamp(getSpan(startY, endY), 1, numVerticalCells);\n\n      return {\n        spanX,\n        spanY,\n        startX,\n        startY,\n        endX,\n        endY,\n      };\n    },\n  };\n};\n","import addDays from 'date-fns/add_days';\nimport addMinutes from 'date-fns/add_minutes';\n\nexport const cellToDate = ({\n  startX,\n  startY,\n  toMin,\n  originDate,\n}: {\n  startX: number;\n  startY: number;\n  toMin: (y: number) => number;\n  toDay: (x: number) => number;\n  originDate: Date;\n}) => addMinutes(addDays(originDate, startX), toMin(startY));\n","import addMinutes from 'date-fns/add_minutes';\nimport compareAsc from 'date-fns/compare_asc';\nimport endOfDay from 'date-fns/end_of_day';\nimport isBefore from 'date-fns/is_before';\nimport min from 'date-fns/min';\nimport range from 'lodash/range';\nimport { DateRange, MapCellInfoToDateRange } from '../types';\nimport { cellToDate } from './cellToDate';\n\nexport type RecurringTimeRange = DateRange[];\n\nexport const createMapCellInfoToRecurringTimeRange: MapCellInfoToDateRange = ({\n  fromY: toMin,\n  fromX: toDay,\n  originDate,\n}) => ({ startX, startY, endX, spanY }) => {\n  const result = range(startX, endX + 1)\n    .map(i => {\n      const startDate = cellToDate({\n        startX: i,\n        startY,\n        toMin,\n        toDay,\n        originDate,\n      });\n      let endDate = min(\n        addMinutes(startDate, toMin(spanY)),\n        endOfDay(startDate),\n      );\n\n      const range: DateRange = isBefore(startDate, endDate)\n        ? [startDate, endDate]\n        : [endDate, startDate];\n\n      return range;\n    })\n    .sort((range1, range2) => compareAsc(range1[0], range2[0]));\n\n  return result;\n};\n","import differenceInDays from 'date-fns/difference_in_days';\nimport differenceInMinutes from 'date-fns/difference_in_minutes';\nimport isEqual from 'date-fns/is_equal';\nimport startOfDay from 'date-fns/start_of_day';\nimport range from 'lodash/range';\nimport { CellInfo, DateRange } from '../types';\nimport { getSpan } from './getSpan';\n\nexport const createMapDateRangeToCells = ({\n  toX = (x: number) => x,\n  toY,\n  numVerticalCells,\n  originDate,\n}: {\n  toX: (day: number) => number;\n  toY: (min: number) => number;\n  numHorizontalCells: number;\n  numVerticalCells: number;\n  originDate: Date;\n}) => ([start, end]: DateRange): CellInfo[] => {\n  const originOfThisDay = startOfDay(start);\n  const _startX = toX(differenceInDays(start, originDate));\n  const _startY = toY(differenceInMinutes(start, originOfThisDay));\n  const _endX = toX(differenceInDays(end, originDate));\n  const _endY = toY(differenceInMinutes(end, startOfDay(end))) - 1;\n\n  const cells = range(_startX, _endX + 1).map(i => {\n    const startX = i;\n    const endX = i;\n    const atStart = i === _startX;\n    const atEnd = i === _endX;\n    const startY = !atStart ? 0 : _startY;\n    const endY = !atEnd ? numVerticalCells - 1 : _endY;\n    const spanX = getSpan(startX, endX);\n    const spanY = getSpan(startY, endY);\n\n    return {\n      startX,\n      startY,\n      endX,\n      endY,\n      spanX,\n      spanY,\n    };\n  });\n\n  if (isEqual(end, startOfDay(end))) {\n    cells.pop();\n  }\n\n  return cells;\n};\n","import compareAsc from 'date-fns/compare_asc';\nimport setDay from 'date-fns/set_day';\nimport { DateRange } from '../types';\n\nexport function getEarliestTimeRange(\n  ranges: DateRange[],\n): DateRange | undefined {\n  return [...ranges].sort(([startA], [startB]) =>\n    compareAsc(setDay(startA, 0), setDay(startB, 0)),\n  )[0];\n}\n","import compareAsc from 'date-fns/compare_asc';\nimport _mergeRanges from 'merge-ranges';\nimport { ScheduleType } from '../types';\n\nexport function mergeRanges(event: ScheduleType): ScheduleType {\n  return _mergeRanges(\n    [...event].map(d => d.map(c => new Date(c)) as [Date, Date]),\n  );\n}\n\nexport function mergeEvents(\n  event1: ScheduleType,\n  event2: ScheduleType | null,\n): ScheduleType {\n  if (event2 === null) {\n    return event1;\n  }\n\n  return mergeRanges([...event1, ...event2]).sort((range1, range2) =>\n    compareAsc(range1[0], range2[0]),\n  );\n}\n","import classcat from 'classcat';\nimport getMinutes from 'date-fns/get_minutes';\nimport React from 'react';\nimport { CellInfo, ClassNames, DateRange } from '../types';\n\nexport const Cell = React.memo(function Cell({\n  timeIndex,\n  children,\n  classes,\n  getDateRangeForVisualGrid,\n  onClick,\n}: {\n  timeIndex: number;\n  classes: ClassNames;\n  getDateRangeForVisualGrid(cell: CellInfo): DateRange[];\n  children?(options: { start: Date; isHourStart: boolean }): React.ReactNode;\n  onClick?: React.MouseEventHandler;\n}) {\n  const [[start]] = getDateRangeForVisualGrid({\n    startX: 0,\n    startY: timeIndex,\n    endX: 0,\n    endY: timeIndex + 1,\n    spanX: 1,\n    spanY: 1,\n  });\n\n  const isHourStart = getMinutes(start) === 0;\n\n  return (\n    <div\n      role=\"button\"\n      onClick={onClick}\n      className={classcat([\n        classes.cell,\n        { [classes['is-hour-start']]: isHourStart },\n      ])}\n    >\n      {children && children({ start, isHourStart })}\n    </div>\n  );\n});\n","import format from 'date-fns/format';\nimport getMinutes from 'date-fns/get_minutes';\nimport isSameDay from 'date-fns/is_same_day';\n\nconst formatTemplate = 'ddd h:mma';\n\nconst dropSame = (\n  dates: [Date, Date],\n  template: string,\n  takeSecond: boolean = false,\n  locale: typeof import('date-fns/locale/en'),\n): [string, string] => {\n  const [first, second] = dates.map(date => format(date, template, { locale }));\n  if (first !== second) {\n    return [first, second];\n  }\n\n  if (takeSecond) {\n    return ['', second];\n  }\n\n  return [first, ''];\n};\n\nconst formatHour = (\n  date: Date,\n  locale: typeof import('date-fns/locale/en'),\n) => {\n  if (getMinutes(date) === 0) {\n    return format(date, 'h', { locale });\n  }\n\n  return format(date, 'h:mm', { locale });\n};\n\ntype Options = {\n  dateRange: [Date, Date];\n  locale: typeof import('date-fns/locale/en');\n  template?: string;\n  template2?: string;\n  includeDayIfSame?: boolean;\n};\n\nexport const getFormattedComponentsForDateRange = ({\n  dateRange,\n  locale,\n  template,\n  template2,\n  includeDayIfSame = true,\n}: Options) => {\n  const start = dateRange[0];\n  const end = dateRange[dateRange.length - 1];\n\n  if (isSameDay(start, end) && !template) {\n    const [firstM, secondM] = dropSame(dateRange, 'a', true, locale);\n    const day = includeDayIfSame ? `${format(start, 'ddd', { locale })} ` : '';\n    return [\n      `${day}${formatHour(start, {\n        locale,\n      })}${firstM}`,\n      `${formatHour(end, { locale })}${secondM}`,\n    ];\n  }\n\n  const startDateStr = format(start, template || formatTemplate, { locale });\n  const endDateStr = format(end, template2 || formatTemplate, { locale });\n\n  return [startDateStr, endDateStr];\n};\n\nexport const getTextForDateRange = (options: Options) => {\n  return getFormattedComponentsForDateRange(options).join(' – ');\n};\n","// @ts-ignore\nimport VisuallyHidden from '@reach/visually-hidden';\nimport React, { useContext } from 'react';\nimport { SchedulerContext } from '../context';\nimport { ClassNames } from '../types';\nimport {\n  getFormattedComponentsForDateRange,\n  getTextForDateRange,\n} from '../utils/getTextForDateRange';\n\nexport type EventContentProps = {\n  width: number;\n  height: number;\n  classes: ClassNames;\n  dateRange: [Date, Date];\n  isStart: boolean;\n  isEnd: boolean;\n};\n\nexport const EventContent = React.memo(function EventContent({\n  width,\n  height,\n  classes,\n  dateRange,\n  isStart,\n  isEnd,\n}: EventContentProps) {\n  const { locale } = useContext(SchedulerContext);\n  const [start, end] = getFormattedComponentsForDateRange({\n    dateRange,\n    locale,\n    includeDayIfSame: false,\n  });\n\n  return (\n    <div\n      style={{ width: width - 20, height }}\n      className={classes['event-content']}\n    >\n      <VisuallyHidden>\n        {getTextForDateRange({ dateRange, locale })}\n      </VisuallyHidden>\n      <span aria-hidden className={classes.start}>\n        {isStart && start}\n      </span>\n      <span aria-hidden className={classes.end}>\n        {isEnd && end}\n      </span>\n    </div>\n  );\n});\n","import classcat from 'classcat';\nimport invariant from 'invariant';\nimport Resizable, { ResizeCallback } from 're-resizable';\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport Draggable, { DraggableEventHandler } from 'react-draggable';\nimport { useMousetrap } from '../hooks/useMousetrap';\nimport { CellInfo } from '../types';\nimport { DefaultEventRootComponent } from './DefaultEventRootComponent';\nimport { EventContent } from './EventContent';\nimport { ScheduleProps } from './Schedule';\n\nexport const RangeBox = React.memo(function RangeBox({\n  classes,\n  grid,\n  rangeIndex,\n  cellIndex,\n  cellArray,\n  cell,\n  className,\n  onChange,\n  cellInfoToDateRange,\n  isResizable,\n  moveAxis,\n  onActiveChange,\n  onClick,\n  getIsActive,\n  eventContentComponent: EventContentComponent = EventContent,\n  eventRootComponent: EventRootComponent = DefaultEventRootComponent,\n  disabled,\n}: ScheduleProps & {\n  cellIndex: number;\n  cellArray: CellInfo[];\n  className?: string;\n  rangeIndex: number;\n  cell: CellInfo;\n}) {\n  const ref = useRef(null);\n  const [modifiedCell, setModifiedCell] = useState(cell);\n  const originalRect = useMemo(() => grid.getRectFromCell(cell), [cell, grid]);\n  const rect = useMemo(() => grid.getRectFromCell(modifiedCell), [\n    modifiedCell,\n    grid,\n  ]);\n\n  useEffect(() => {\n    setModifiedCell(cell);\n  }, [cell]);\n\n  const modifiedDateRange = useMemo(() => cellInfoToDateRange(modifiedCell), [\n    cellInfoToDateRange,\n    modifiedCell,\n  ]);\n\n  const { top, left, width, height } = rect;\n\n  const isStart = cellIndex === 0;\n  const isEnd = cellIndex === cellArray.length - 1;\n\n  const handleStop = useCallback(() => {\n    if (!onChange || disabled) {\n      return;\n    }\n\n    onChange(cellInfoToDateRange(modifiedCell), rangeIndex);\n  }, [modifiedCell, rangeIndex, disabled, cellInfoToDateRange, onChange]);\n\n  const isActive = useMemo(() => getIsActive({ cellIndex, rangeIndex }), [\n    cellIndex,\n    rangeIndex,\n    getIsActive,\n  ]);\n\n  useMousetrap(\n    'up',\n    () => {\n      if (!onChange || disabled || !isActive) {\n        return;\n      }\n\n      if (moveAxis === 'none' || moveAxis === 'x') {\n        return;\n      }\n\n      if (modifiedCell.startY === 0) {\n        return;\n      }\n\n      const newCell = {\n        ...modifiedCell,\n        startY: modifiedCell.startY - 1,\n        endY: modifiedCell.endY - 1,\n      };\n\n      onChange(cellInfoToDateRange(newCell), rangeIndex);\n    },\n    ref,\n  );\n\n  useMousetrap(\n    'shift+up',\n    () => {\n      if (!onChange || !isResizable || disabled || !isActive) {\n        return;\n      }\n\n      if (\n        modifiedCell.endY === modifiedCell.startY ||\n        modifiedCell.spanY === 0\n      ) {\n        return;\n      }\n\n      const newCell = {\n        ...modifiedCell,\n        endY: modifiedCell.endY - 1,\n        spanY: modifiedCell.spanY - 1,\n      };\n\n      onChange(cellInfoToDateRange(newCell), rangeIndex);\n    },\n    ref,\n  );\n\n  useMousetrap(\n    'down',\n    () => {\n      if (!onChange || disabled || !isActive) {\n        return;\n      }\n\n      if (moveAxis === 'none' || moveAxis === 'x') {\n        return;\n      }\n\n      if (Math.round(modifiedCell.endY) >= grid.numVerticalCells - 1) {\n        return;\n      }\n\n      const newCell = {\n        ...modifiedCell,\n        startY: modifiedCell.startY + 1,\n        endY: modifiedCell.endY + 1,\n      };\n\n      onChange(cellInfoToDateRange(newCell), rangeIndex);\n    },\n    ref,\n  );\n\n  useMousetrap(\n    'shift+down',\n    () => {\n      if (!onChange || !isResizable || disabled || !isActive) {\n        return;\n      }\n\n      if (moveAxis === 'none' || moveAxis === 'x') {\n        return;\n      }\n\n      if (Math.round(modifiedCell.endY) >= grid.numVerticalCells - 1) {\n        return;\n      }\n\n      const newCell = {\n        ...modifiedCell,\n        spanY: modifiedCell.spanY + 1,\n        endY: modifiedCell.endY + 1,\n      };\n\n      onChange(cellInfoToDateRange(newCell), rangeIndex);\n    },\n    ref,\n  );\n\n  const handleDrag: DraggableEventHandler = useCallback(\n    (event, { y, x }) => {\n      if (moveAxis === 'none' || disabled) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      const newRect = {\n        ...rect,\n      };\n\n      if (moveAxis === 'both' || moveAxis === 'y') {\n        const startOrEnd1 = y;\n        const startOrEnd2 = startOrEnd1 + rect.height;\n        const newTop = Math.min(startOrEnd1, startOrEnd2);\n        const newBottom = newTop + rect.height;\n        newRect.bottom = newBottom;\n        newRect.top = newTop;\n      }\n\n      if (moveAxis === 'both' || moveAxis === 'x') {\n        const startOrEnd1 = x;\n        const startOrEnd2 = startOrEnd1 + rect.width;\n        const newLeft = Math.min(startOrEnd1, startOrEnd2);\n        const newRight = newLeft + rect.width;\n        newRect.right = newRight;\n        newRect.left = newLeft;\n      }\n\n      const { startY, startX } = grid.getCellFromRect(newRect);\n\n      const newCell = {\n        ...cell,\n        startX: moveAxis === 'y' ? cell.startX : startX,\n        endX: moveAxis === 'x' ? startX + cell.spanX - 1 : cell.endX,\n        startY: moveAxis === 'x' ? cell.startY : startY,\n        endY: moveAxis === 'y' ? startY + cell.spanY - 1 : cell.endY,\n      };\n\n      invariant(\n        newCell.spanY === cell.spanY && newCell.spanX === cell.spanX,\n        `Expected the dragged time cell to have the same dimensions`,\n      );\n\n      setModifiedCell(newCell);\n    },\n    [grid, rect, moveAxis, disabled, cell, setModifiedCell],\n  );\n\n  const handleResize: ResizeCallback = useCallback(\n    (event, direction, _ref, delta) => {\n      if (!isResizable || disabled) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (delta.height === 0) {\n        return;\n      }\n\n      const newSize = {\n        height: delta.height + rect.height,\n        width: delta.width + rect.width + 20,\n      };\n\n      const newRect = {\n        ...originalRect,\n        ...newSize,\n      };\n\n      if (direction.includes('top')) {\n        newRect.top -= delta.height;\n      } else if (direction.includes('bottom')) {\n        newRect.bottom += delta.height;\n      }\n\n      const { spanY, startY, endY } = grid.getCellFromRect(newRect);\n      const newCell = {\n        ...cell,\n        spanY,\n        startY,\n        endY,\n      };\n\n      setModifiedCell(newCell);\n    },\n    [grid, rect, disabled, isResizable, setModifiedCell, cell, originalRect],\n  );\n\n  const handleDelete = useCallback(() => {\n    if (!onChange || disabled) {\n      return;\n    }\n\n    onChange(undefined, rangeIndex);\n  }, [onChange, disabled, rangeIndex]);\n\n  const handleOnFocus = useCallback(() => {\n    if (!onActiveChange || disabled) {\n      return;\n    }\n\n    onActiveChange([rangeIndex, cellIndex]);\n  }, [onActiveChange, disabled, rangeIndex, cellIndex]);\n\n  const handleOnClick = useCallback(() => {\n    if (!onClick || disabled || !isActive) {\n      return;\n    }\n\n    onClick([rangeIndex, cellIndex]);\n  }, [onClick, rangeIndex, disabled, isActive, cellIndex]);\n\n  useMousetrap('enter', handleOnClick, ref);\n\n  const cancelClasses = useMemo(\n    () =>\n      classes.handle\n        ? classes.handle\n            .split(' ')\n            .map(className => `.${className}`)\n            .join(', ')\n        : undefined,\n    [classes.handle],\n  );\n\n  return (\n    <Draggable\n      axis={moveAxis}\n      bounds={{\n        top: 0,\n        bottom: grid.totalHeight - height,\n        left: 0,\n        right: grid.totalWidth,\n      }}\n      position={{ x: left, y: top }}\n      onDrag={handleDrag}\n      onStop={handleStop}\n      cancel={cancelClasses}\n      disabled={disabled}\n    >\n      <EventRootComponent\n        role=\"button\"\n        disabled={disabled}\n        onFocus={handleOnFocus}\n        onClick={handleOnClick}\n        handleDelete={handleDelete}\n        cellIndex={cellIndex}\n        rangeIndex={rangeIndex}\n        isActive={isActive}\n        classes={classes}\n        className={classcat([\n          classes.event,\n          classes['range-boxes'],\n          className,\n          {\n            [classes['is-draggable']]: !disabled && moveAxis !== 'none',\n            [classes['is-disabled']]: disabled,\n          },\n        ])}\n        ref={ref}\n        style={{ width: width - 20, height }}\n      >\n        <Resizable\n          size={{ ...originalRect, width: originalRect.width - 20 }}\n          key={`${rangeIndex}.${cellIndex}.${cellArray.length}.${\n            originalRect.top\n          }.${originalRect.left}`}\n          onResize={handleResize}\n          onResizeStop={handleStop}\n          handleWrapperClass={classes['handle-wrapper']}\n          enable={\n            isResizable && !disabled\n              ? {\n                  top: true,\n                  bottom: true,\n                }\n              : {}\n          }\n          handleClasses={{\n            bottom: classcat([classes.handle, classes.bottom]),\n            bottomLeft: classes.handle,\n            bottomRight: classes.handle,\n            left: classes.handle,\n            right: classes.handle,\n            top: classcat([classes.handle, classes.top]),\n            topLeft: classes.handle,\n            topRight: classes.handle,\n          }}\n        >\n          <EventContentComponent\n            width={width}\n            height={height}\n            classes={classes}\n            dateRange={modifiedDateRange}\n            isStart={isStart}\n            isEnd={isEnd}\n          />\n        </Resizable>\n      </EventRootComponent>\n    </Draggable>\n  );\n});\n","import React from 'react';\nimport {\n  CellInfo,\n  ClassNames,\n  DateRange,\n  Grid,\n  OnChangeCallback,\n  ScheduleType,\n} from '../types';\nimport { RangeBox } from './RangeBox';\n\nexport type ScheduleProps = {\n  classes: ClassNames;\n  grid: Grid;\n  onChange?: OnChangeCallback;\n  isResizable?: boolean;\n  isDeletable?: boolean;\n  moveAxis: 'none' | 'both' | 'x' | 'y';\n  cellInfoToDateRange(cell: CellInfo): DateRange;\n  onActiveChange?(index: [number, number] | [null, null]): void;\n  onClick?(index: [number, number] | [null, null]): void;\n  getIsActive(indexes: { cellIndex: number; rangeIndex: number }): boolean;\n  eventContentComponent?: any;\n  eventRootComponent?: any;\n  disabled?: boolean;\n};\n\nexport const Schedule = React.memo(function Schedule({\n  classes,\n  ranges,\n  grid,\n  className,\n  onChange,\n  isResizable,\n  isDeletable,\n  moveAxis,\n  cellInfoToDateRange,\n  dateRangeToCells,\n  onActiveChange,\n  eventContentComponent,\n  eventRootComponent,\n  onClick,\n  getIsActive,\n  disabled,\n}: {\n  dateRangeToCells(range: DateRange): CellInfo[];\n  ranges: ScheduleType;\n  className?: string;\n  classes: ClassNames;\n} & ScheduleProps) {\n  return (\n    <div className={classes['range-boxes']}>\n      {ranges.map((dateRange, rangeIndex) => {\n        return (\n          <span key={rangeIndex}>\n            {dateRangeToCells(dateRange).map((cell, cellIndex, cellArray) => {\n              return (\n                <RangeBox\n                  classes={classes}\n                  onActiveChange={onActiveChange}\n                  key={`${rangeIndex}.${ranges.length}.${cellIndex}.${\n                    cellArray.length\n                  }`}\n                  isResizable={isResizable}\n                  moveAxis={moveAxis}\n                  isDeletable={isDeletable}\n                  cellInfoToDateRange={cellInfoToDateRange}\n                  cellArray={cellArray}\n                  cellIndex={cellIndex}\n                  rangeIndex={rangeIndex}\n                  className={className}\n                  onChange={onChange}\n                  onClick={onClick}\n                  grid={grid}\n                  cell={cell}\n                  getIsActive={getIsActive}\n                  eventContentComponent={eventContentComponent}\n                  eventRootComponent={eventRootComponent}\n                  disabled={disabled}\n                />\n              );\n            })}\n          </span>\n        );\n      })}\n    </div>\n  );\n});\n","import useComponentSize from '@rehooks/component-size';\nimport classcat from 'classcat';\nimport addDays from 'date-fns/add_days';\nimport addHours from 'date-fns/add_hours';\nimport format from 'date-fns/format';\nimport isDateEqual from 'date-fns/is_equal';\nimport startOfDay from 'date-fns/start_of_day';\nimport invariant from 'invariant';\nimport isEqual from 'lodash/isEqual';\nimport times from 'lodash/times';\nimport React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport scrollIntoView from 'scroll-into-view-if-needed';\nimport { SchedulerContext } from '../context';\nimport { useClickAndDrag } from '../hooks/useClickAndDrag';\nimport { useMousetrap } from '../hooks/useMousetrap';\nimport {\n  CellInfo,\n  ClassNames,\n  DateRange,\n  Grid,\n  OnChangeCallback,\n  ScheduleType,\n} from '../types';\nimport { createGrid } from '../utils/createGrid';\nimport {\n  createMapCellInfoToRecurringTimeRange,\n  RecurringTimeRange,\n} from '../utils/createMapCellInfoToRecurringTimeRange';\nimport { createMapDateRangeToCells } from '../utils/createMapDateRangeToCells';\nimport { getEarliestTimeRange } from '../utils/getEarliestTimeRange';\nimport { getSpan } from '../utils/getSpan';\nimport { mergeEvents, mergeRanges } from '../utils/mergeEvents';\nimport { Cell } from './Cell';\nimport { Schedule, ScheduleProps } from './Schedule';\n\nconst MINS_IN_DAY = 24 * 60;\nconst horizontalPrecision = 1;\nconst toDay = (x: number): number => x * horizontalPrecision;\nconst toX = (days: number): number => days / horizontalPrecision;\nconst DELETE_KEYS = ['del', 'backspace'];\n\nexport const TimeGridScheduler = React.memo(function TimeGridScheduler({\n  verticalPrecision = 30,\n  visualGridVerticalPrecision = 30,\n  cellClickPrecision = visualGridVerticalPrecision,\n  style,\n  schedule,\n  originDate: _originDate = new Date(),\n  defaultHours = [9, 15],\n  classes,\n  className,\n  onChange,\n  onEventClick,\n  eventContentComponent,\n  eventRootComponent,\n  disabled,\n}: {\n  originDate?: Date;\n\n  /**\n   * The minimum number of minutes a created range can span\n   * @default 30\n   */\n  verticalPrecision?: number;\n\n  /**\n   * The visual grid increments in minutes.\n   * @default 30\n   */\n  visualGridVerticalPrecision?: number;\n\n  /**\n   * The minimum number of minutes for an time block\n   * created with a single click.\n   * @default visualGridVerticalPrecision\n   */\n  cellClickPrecision?: number;\n\n  /** Custom styles applied to the root of the view */\n  style?: React.CSSProperties;\n  schedule: ScheduleType;\n\n  /**\n   * A map of class names to the scoped class names\n   * The keys are class names like `'root'` and the values\n   * are the corresponding class names which can be scoped\n   * with CSS Modules, e.g. `'_root_7f2c6'`.\n   */\n  classes: ClassNames;\n  className?: string;\n\n  /**\n   * The view will initially be scrolled to these hours.\n   * Defaults to work hours (9-17).\n   * @default [9, 17]\n   */\n  defaultHours?: [number, number];\n  onChange(newSchedule: ScheduleType): void;\n  onEventClick?: ScheduleProps['onClick'];\n  eventContentComponent?: ScheduleProps['eventContentComponent'];\n  eventRootComponent?: ScheduleProps['eventRootComponent'];\n  disabled?: boolean;\n}) {\n  const { locale } = useContext(SchedulerContext);\n  const originDate = useMemo(() => startOfDay(_originDate), [_originDate]);\n  const numVerticalCells = MINS_IN_DAY / verticalPrecision;\n  const numHorizontalCells = 7 / horizontalPrecision;\n  const toMin = useCallback((y: number) => y * verticalPrecision, [\n    verticalPrecision,\n  ]);\n  const toY = useCallback((mins: number): number => mins / verticalPrecision, [\n    verticalPrecision,\n  ]);\n\n  const cellInfoToDateRanges = useMemo(() => {\n    return createMapCellInfoToRecurringTimeRange({\n      originDate,\n      fromY: toMin,\n      fromX: toDay,\n    });\n  }, [toMin, originDate]);\n\n  const cellInfoToSingleDateRange = useCallback(\n    (cell: CellInfo): DateRange => {\n      const [first, ...rest] = cellInfoToDateRanges(cell);\n      invariant(\n        rest.length === 0,\n        `Expected \"cellInfoToSingleDateRange\" to return a single date range, found ${\n          rest.length\n        } additional ranges instead. This is a bug in @remotelock/react-week-scheduler`,\n      );\n\n      return first;\n    },\n    [cellInfoToDateRanges],\n  );\n\n  const dateRangeToCells = useMemo(() => {\n    return createMapDateRangeToCells({\n      originDate,\n      numVerticalCells,\n      numHorizontalCells,\n      toX,\n      toY,\n    });\n  }, [toY, numVerticalCells, numHorizontalCells, originDate]);\n\n  const root = useRef<HTMLDivElement | null>(null);\n  const parent = useRef<HTMLDivElement | null>(null);\n\n  const size = useComponentSize(parent);\n  const {\n    style: dragBoxStyle,\n    box,\n    isDragging,\n    hasFinishedDragging,\n    cancel,\n  } = useClickAndDrag(parent, disabled);\n  const [\n    pendingCreation,\n    setPendingCreation,\n  ] = useState<RecurringTimeRange | null>(null);\n\n  const [[totalHeight, totalWidth], setDimensions] = useState([0, 0]);\n\n  const numVisualVerticalCells = (24 * 60) / visualGridVerticalPrecision;\n\n  useEffect(\n    function updateGridDimensionsOnSizeOrCellCountChange() {\n      if (!parent.current) {\n        setDimensions([0, 0]);\n        return;\n      }\n\n      setDimensions([parent.current.scrollHeight, parent.current.scrollWidth]);\n    },\n    [size, numVisualVerticalCells],\n  );\n\n  const grid = useMemo<Grid | null>(() => {\n    if (totalHeight === null || totalWidth === null) {\n      return null;\n    }\n\n    return createGrid({\n      totalHeight,\n      totalWidth,\n      numHorizontalCells,\n      numVerticalCells,\n    });\n  }, [totalHeight, totalWidth, numHorizontalCells, numVerticalCells]);\n\n  useEffect(\n    function updatePendingCreationOnDragBoxUpdate() {\n      if (grid === null || box === null) {\n        setPendingCreation(null);\n        return;\n      }\n\n      const cell = grid.getCellFromRect(box);\n      const dateRanges = cellInfoToDateRanges(cell);\n      const event = dateRanges;\n      setPendingCreation(event);\n    },\n    [box, grid, cellInfoToDateRanges, toY],\n  );\n\n  const [[activeRangeIndex, activeCellIndex], setActive] = useState<\n    [number, number] | [null, null]\n  >([null, null]);\n\n  useEffect(\n    function updateScheduleAfterDraggingFinished() {\n      if (disabled) {\n        return;\n      }\n\n      if (hasFinishedDragging) {\n        onChange(mergeEvents(schedule, pendingCreation));\n        setPendingCreation(null);\n      }\n    },\n    [\n      hasFinishedDragging,\n      disabled,\n      onChange,\n      setPendingCreation,\n      pendingCreation,\n      schedule,\n    ],\n  );\n\n  useEffect(\n    function clearActiveBlockAfterCreation() {\n      if (pendingCreation === null) {\n        setActive([null, null]);\n      }\n    },\n    [pendingCreation],\n  );\n\n  const handleEventChange = useCallback<OnChangeCallback>(\n    (newDateRange, rangeIndex) => {\n      if (disabled) {\n        return;\n      }\n\n      if (!schedule && newDateRange) {\n        onChange([newDateRange]);\n\n        return;\n      }\n\n      let newSchedule = [...schedule];\n\n      if (!newDateRange) {\n        newSchedule.splice(rangeIndex, 1);\n      } else {\n        if (\n          isDateEqual(newDateRange[0], newSchedule[rangeIndex][0]) &&\n          isDateEqual(newDateRange[1], newSchedule[rangeIndex][1])\n        ) {\n          return;\n        }\n        newSchedule[rangeIndex] = newDateRange;\n      }\n\n      newSchedule = mergeRanges(newSchedule);\n\n      onChange(newSchedule);\n    },\n    [schedule, onChange, disabled],\n  );\n\n  useMousetrap(\n    'esc',\n    function cancelOnEsc() {\n      if (pendingCreation) {\n        cancel();\n      }\n    },\n    document,\n  );\n\n  const getIsActive = useCallback(\n    ({ rangeIndex, cellIndex }) => {\n      return rangeIndex === activeRangeIndex && cellIndex === activeCellIndex;\n    },\n    [activeCellIndex, activeRangeIndex],\n  );\n\n  const handleDelete = useCallback(\n    (e: ExtendedKeyboardEvent) => {\n      if (activeRangeIndex === null || disabled) {\n        return;\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n      handleEventChange(undefined, activeRangeIndex);\n    },\n    [activeRangeIndex, disabled, handleEventChange],\n  );\n\n  useMousetrap(DELETE_KEYS, handleDelete, root);\n\n  useEffect(\n    function cancelPendingCreationOnSizeChange() {\n      cancel();\n    },\n    [size, cancel],\n  );\n\n  const getDateRangeForVisualGrid = useMemo(() => {\n    return createMapCellInfoToRecurringTimeRange({\n      originDate,\n      fromX: toDay,\n      fromY: y => y * visualGridVerticalPrecision,\n    });\n  }, [visualGridVerticalPrecision, originDate]);\n\n  useEffect(\n    function scrollToActiveTimeBlock() {\n      if (!document.activeElement) {\n        return;\n      }\n\n      if (!root.current || !root.current.contains(document.activeElement)) {\n        return;\n      }\n\n      scrollIntoView(document.activeElement, {\n        scrollMode: 'if-needed',\n        block: 'nearest',\n        inline: 'nearest',\n      });\n    },\n    [schedule],\n  );\n\n  const [wasInitialScrollPerformed, setWasInitialScrollPerformed] = useState(\n    false,\n  );\n\n  useEffect(\n    function performInitialScroll() {\n      if (wasInitialScrollPerformed || !root.current || !grid) {\n        return;\n      }\n\n      const range = dateRangeToCells(\n        getEarliestTimeRange(schedule) || [\n          addHours(originDate, defaultHours[0]),\n          addHours(originDate, defaultHours[1]),\n        ],\n      );\n      const rect = grid.getRectFromCell(range[0]);\n      const { top, bottom } = rect;\n\n      if (top === 0 && bottom === 0) {\n        return;\n      }\n\n      // IE, Edge do not support it\n      if (!('scrollBy' in root.current)) {\n        return;\n      }\n\n      root.current.scrollBy(0, top);\n\n      setWasInitialScrollPerformed(true);\n    },\n    [\n      wasInitialScrollPerformed,\n      grid,\n      schedule,\n      defaultHours,\n      originDate,\n      dateRangeToCells,\n    ],\n  );\n\n  const handleBlur: React.FocusEventHandler = useCallback(\n    event => {\n      if (!event.target.contains(document.activeElement)) {\n        setActive([null, null]);\n      }\n    },\n    [setActive],\n  );\n\n  const handleCellClick = useCallback(\n    (dayIndex: number, timeIndex: number) => (event: React.MouseEvent) => {\n      if (!grid || disabled) {\n        return;\n      }\n\n      const spanY = toY(cellClickPrecision);\n      const cell = {\n        startX: dayIndex,\n        startY: timeIndex,\n        endX: dayIndex,\n        endY: spanY + timeIndex,\n        spanY,\n        spanX: getSpan(dayIndex, dayIndex),\n      };\n\n      const dateRanges = cellInfoToDateRanges(cell);\n\n      setPendingCreation(dateRanges);\n\n      event.stopPropagation();\n      event.preventDefault();\n    },\n    [grid, disabled, toY, cellClickPrecision, cellInfoToDateRanges],\n  );\n\n  return (\n    <div\n      ref={root}\n      style={style}\n      onBlur={handleBlur}\n      touch-action={isDragging ? 'none' : undefined}\n      className={classcat([\n        classes.root,\n        classes.theme,\n        className,\n        { [classes['no-scroll']]: isDragging },\n      ])}\n    >\n      <div className={classes['grid-root']}>\n        <div\n          aria-hidden\n          className={classcat([classes.timeline, classes['sticky-left']])}\n        >\n          <div className={classes.header}>\n            <div className={classes['day-column']}>\n              <div className={classcat([classes.cell, classes.title])}>T</div>\n            </div>\n          </div>\n          <div className={classes.calendar}>\n            <div className={classes['day-column']}>\n              <div className={classes['day-hours']}>\n                {times(numVisualVerticalCells).map(timeIndex => {\n                  return (\n                    <Cell\n                      classes={classes}\n                      getDateRangeForVisualGrid={getDateRangeForVisualGrid}\n                      key={timeIndex}\n                      timeIndex={timeIndex}\n                    >\n                      {({ start, isHourStart }) => {\n                        if (isHourStart) {\n                          return (\n                            <div className={classes.time}>\n                              {format(start, 'h a', { locale })}\n                            </div>\n                          );\n                        }\n\n                        return null;\n                      }}\n                    </Cell>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n        </div>\n        <div\n          className={classcat([\n            classes['sticky-top'],\n            classes['day-header-row'],\n          ])}\n        >\n          <div\n            role=\"presentation\"\n            className={classcat([classes.calendar, classes.header])}\n          >\n            {times(7).map(i => (\n              <div\n                key={i}\n                role=\"presentation\"\n                className={classes['day-column']}\n              >\n                <div className={classcat([classes.cell, classes.title])}>\n                  {format(addDays(originDate, i), 'ddd', { locale })}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n        <div className={classes['layer-container']}>\n          {isDragging && (\n            <div className={classes['drag-box']} style={dragBoxStyle}>\n              {hasFinishedDragging && <div className={classes.popup} />}\n            </div>\n          )}\n          {grid && pendingCreation && isDragging && (\n            <Schedule\n              classes={classes}\n              dateRangeToCells={dateRangeToCells}\n              cellInfoToDateRange={cellInfoToSingleDateRange}\n              className={classes['is-pending-creation']}\n              ranges={mergeEvents(schedule, pendingCreation)}\n              grid={grid}\n              moveAxis=\"none\"\n              eventContentComponent={eventContentComponent}\n              getIsActive={getIsActive}\n            />\n          )}\n          {grid && !pendingCreation && (\n            <Schedule\n              classes={classes}\n              onActiveChange={setActive}\n              dateRangeToCells={dateRangeToCells}\n              cellInfoToDateRange={cellInfoToSingleDateRange}\n              isResizable\n              moveAxis=\"y\"\n              isDeletable\n              onChange={handleEventChange}\n              onClick={onEventClick}\n              ranges={schedule}\n              grid={grid}\n              eventContentComponent={eventContentComponent}\n              eventRootComponent={eventRootComponent}\n              getIsActive={getIsActive}\n              disabled={disabled}\n            />\n          )}\n\n          <div ref={parent} role=\"grid\" className={classes.calendar}>\n            {times(7).map(dayIndex => {\n              return (\n                <div\n                  role=\"gridcell\"\n                  key={dayIndex}\n                  className={classes['day-column']}\n                >\n                  <div className={classes['day-hours']}>\n                    {times(numVisualVerticalCells).map(timeIndex => {\n                      return (\n                        <Cell\n                          classes={classes}\n                          onClick={handleCellClick(\n                            dayIndex,\n                            timeIndex *\n                              (numVerticalCells / numVisualVerticalCells),\n                          )}\n                          getDateRangeForVisualGrid={getDateRangeForVisualGrid}\n                          key={timeIndex}\n                          timeIndex={timeIndex}\n                        />\n                      );\n                    })}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}, isEqual);\n"],"names":["DefaultEventRootComponent","React","forwardRef","ref","isActive","handleDelete","cellIndex","rangeIndex","classes","disabled","props","SchedulerContext","createContext","locale","en","createPageMapCoordsToContainer","container","event","clientX","clientY","pageX","pageY","changedTouches","getBoundingClientRect","top","left","x","y","prevent","tap","e","preventDefault","stopPropagation","useClickAndDrag","isDisabled","useState","transform","width","height","style","setStyle","box","setBox","isDragging","setIsDragging","hasFinishedDragging","setHasFinishedDragging","current","useEffect","mapCoordsToContainer","touchMove$","fromEvent","window","passive","pipe","touchEnd$","touchStart$","touchStartWithDelay$","mergeMap","start","of","delay","takeUntil","mouseDown$","filter","which","mouseMove$","mouseUp$","dragStart$","merge","map","dragEnd$","move$","box$","down","startWith","move","startX","Math","max","startY","endX","min","scrollWidth","endY","scrollHeight","bottom","right","rect","style$","display","boxSubscriber","subscribe","styleSubscriber","unsubscribe","cancel","useCallback","useMousetrap","handlerKey","handlerCallback","elementOrElementRef","actionRef","useRef","element","document","instance","Mousetrap","bind","combo","unbind","getSpan","x1","x2","abs","createGrid","totalHeight","totalWidth","numVerticalCells","numHorizontalCells","cellHeight","cellWidth","getRectFromCell","data","spanX","spanY","getCellFromRect","clamp","floor","round","cellToDate","toMin","originDate","addMinutes","addDays","createMapCellInfoToRecurringTimeRange","fromY","toDay","fromX","result","range","i","startDate","endDate","endOfDay","isBefore","sort","range1","range2","compareAsc","createMapDateRangeToCells","toX","toY","end","originOfThisDay","startOfDay","_startX","differenceInDays","_startY","differenceInMinutes","_endX","_endY","cells","atStart","atEnd","isEqual","pop","getEarliestTimeRange","ranges","startA","startB","setDay","mergeRanges","_mergeRanges","d","c","Date","mergeEvents","event1","event2","Cell","memo","timeIndex","children","getDateRangeForVisualGrid","onClick","isHourStart","getMinutes","classcat","cell","formatTemplate","dropSame","dates","template","takeSecond","date","format","first","second","formatHour","getFormattedComponentsForDateRange","dateRange","template2","includeDayIfSame","length","isSameDay","firstM","secondM","day","startDateStr","endDateStr","getTextForDateRange","options","join","EventContent","isStart","isEnd","useContext","RangeBox","grid","cellArray","className","onChange","cellInfoToDateRange","isResizable","moveAxis","onActiveChange","getIsActive","eventContentComponent","EventContentComponent","eventRootComponent","EventRootComponent","modifiedCell","setModifiedCell","originalRect","useMemo","modifiedDateRange","handleStop","newCell","handleDrag","newRect","startOrEnd1","startOrEnd2","newTop","newBottom","newLeft","newRight","invariant","handleResize","direction","_ref","delta","newSize","includes","undefined","handleOnFocus","handleOnClick","cancelClasses","handle","split","bottomLeft","bottomRight","topLeft","topRight","Schedule","isDeletable","dateRangeToCells","MINS_IN_DAY","horizontalPrecision","days","DELETE_KEYS","TimeGridScheduler","verticalPrecision","visualGridVerticalPrecision","cellClickPrecision","schedule","_originDate","defaultHours","onEventClick","mins","cellInfoToDateRanges","cellInfoToSingleDateRange","rest","root","parent","size","useComponentSize","dragBoxStyle","pendingCreation","setPendingCreation","setDimensions","numVisualVerticalCells","updateGridDimensionsOnSizeOrCellCountChange","updatePendingCreationOnDragBoxUpdate","dateRanges","activeRangeIndex","activeCellIndex","setActive","updateScheduleAfterDraggingFinished","clearActiveBlockAfterCreation","handleEventChange","newDateRange","newSchedule","splice","isDateEqual","cancelOnEsc","cancelPendingCreationOnSizeChange","scrollToActiveTimeBlock","activeElement","contains","scrollIntoView","scrollMode","block","inline","wasInitialScrollPerformed","setWasInitialScrollPerformed","performInitialScroll","addHours","scrollBy","handleBlur","target","handleCellClick","dayIndex","theme","timeline","header","title","calendar","times","time","popup"],"mappings":"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"}